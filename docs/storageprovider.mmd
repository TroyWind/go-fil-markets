stateDiagram-v2
	state "StorageDealUnknown" as 0
	state "StorageDealStaged" as 4
	state "StorageDealSealing" as 5
	state "StorageDealActive" as 6
	state "StorageDealFailing" as 9
	state "StorageDealValidating" as 13
	state "StorageDealAcceptWait" as 14
	state "StorageDealTransferring" as 16
	state "StorageDealWaitingForData" as 17
	state "StorageDealVerifyData" as 18
	state "StorageDealEnsureProviderFunds" as 19
	state "StorageDealProviderFunding" as 21
	state "StorageDealPublish" as 23
	state "StorageDealPublishing" as 24
	state "StorageDealError" as 25
	state "StorageDealCompleted" as 26
	4 : On entry runs HandoffDeal
	5 : On entry runs VerifyDealActivated
	6 : On entry runs RecordPieceInfo
	9 : On entry runs FailDeal
	13 : On entry runs ValidateDealProposal
	14 : On entry runs DecideOnProposal
	18 : On entry runs VerifyData
	19 : On entry runs EnsureProviderFunds
	21 : On entry runs WaitForFunding
	23 : On entry runs PublishDeal
	24 : On entry runs WaitForPublish
	[*] --> 0
	note right of 0
		The following events are not shown cause they can trigger from any state.

		ProviderEventNodeErrored - transitions state to StorageDealFailing
		ProviderEventRestart - does not transition state
	end note
	0 --> 13 : ProviderEventOpen
	13 --> 9 : ProviderEventDealRejected
	14 --> 9 : ProviderEventDealRejected
	18 --> 9 : ProviderEventDealRejected
	13 --> 14 : ProviderEventDealDeciding
	14 --> 17 : ProviderEventDataRequested
	16 --> 9 : ProviderEventDataTransferFailed
	17 --> 16 : ProviderEventDataTransferInitiated
	16 --> 18 : ProviderEventDataTransferCompleted
	18 --> 9 : ProviderEventGeneratePieceCIDFailed
	17 --> 19 : ProviderEventVerifiedData
	18 --> 19 : ProviderEventVerifiedData
	19 --> 21 : ProviderEventFundingInitiated
	19 --> 23 : ProviderEventFunded
	21 --> 23 : ProviderEventFunded
	23 --> 24 : ProviderEventDealPublishInitiated
	24 --> 9 : ProviderEventDealPublishError
	9 --> 25 : ProviderEventSendResponseFailed
	14 --> 25 : ProviderEventSendResponseFailed
	24 --> 25 : ProviderEventSendResponseFailed
	24 --> 4 : ProviderEventDealPublished
	4 --> 9 : ProviderEventFileStoreErrored
	5 --> 9 : ProviderEventFileStoreErrored
	6 --> 9 : ProviderEventFileStoreErrored
	4 --> 9 : ProviderEventDealHandoffFailed
	4 --> 5 : ProviderEventDealHandedOff
	5 --> 9 : ProviderEventDealActivationFailed
	5 --> 6 : ProviderEventDealActivated
	6 --> 9 : ProviderEventPieceStoreErrored
	6 --> 26 : ProviderEventDealCompleted
	6 --> 9 : ProviderEventUnableToLocatePiece
	6 --> 9 : ProviderEventReadMetadataErrored
	9 --> 25 : ProviderEventFailed
	25 --> [*]
	26 --> [*]
